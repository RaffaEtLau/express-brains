<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EXPRESS BRAINS | Victoire !</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="icon"
      type="image/png"
      href="https://img.icons8.com/color/48/000000/brain.png"
    />
  </head>
  <body>
    <div class="nav-container">
      <nav class="navbar">
        <div class="nav-brand">
          <a href="/">Express Brain</a>
        </div>
        <div class="nav-links">
          <a href="/game/play" class="nav-link">Jouer</a>
          <a href="/game/leaderboard" class="nav-link">Classement</a>
          <a href="/game/teams" class="nav-link">Équipes</a>
        </div>
        <div class="nav-auth">
          <% if (user) { %>
          <span class="user-info">
            <i class="fas fa-user"></i> <%= user.pseudo %>
          </span>
          <a href="/auth/logout" class="auth-link">
            <i class="fas fa-sign-out-alt"></i> Déconnexion
          </a>
          <% } else { %>
          <a href="/auth/login" class="auth-link">
            <i class="fas fa-sign-in-alt"></i> Connexion
          </a>
          <% } %>
        </div>
      </nav>
    </div>

    <div class="container">
      <header class="main-header">
        <h1>EXPRESS BRAINS</h1>
        <p>
          Découvrez en un minimum de tours le nombre qui se cache derrière la
          carte mystère !
        </p>
      </header>

      <main>
        <div class="card">
          <div id="confetti-container"></div>

          <div class="number-display"><%= secretNumber %></div>

          <h2>
            <i
              class="fas fa-trophy"
              style="color: gold; margin-right: 0.5rem"
            ></i>
            Bravo !
          </h2>
          <p style="margin-bottom: 2rem">
            Vous avez découvert le nombre mystère en
            <strong><%= attempts %></strong> tentative<%= attempts > 1 ? 's' :
            '' %>.
          </p>

          <div class="performance" style="margin-bottom: 2rem">
            <div
              style="
                background-color: #e2e8f0;
                height: 8px;
                border-radius: 4px;
                width: 100%;
                position: relative;
                overflow: hidden;
              "
            >
              <% var performancePercent = 0; if (attempts <= 4) {
              performancePercent = 100; } else if (attempts <= 7) {
              performancePercent = 80; } else if (attempts <= 10) {
              performancePercent = 50; } else { performancePercent = 30; } var
              barColor = '#6eb670'; if (attempts > 10) { barColor = '#f56565'; }
              else if (attempts > 7) { barColor = '#f6e05e'; } %>
              <div
                style="
                  position: absolute;
                  height: 100%;
                  width: <%= performancePercent %>%;
                  background-color: <%= barColor %>;
                  border-radius: 4px;
                "
              ></div>
            </div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-top: 0.5rem;
                font-size: 0.875rem;
                color: #718096;
              "
            >
              <span>Excellent (≤4)</span>
              <span>Bon (5-7)</span>
              <span>Peut mieux faire (8+)</span>
            </div>
          </div>

          <% var feedbackMessage = ''; if (attempts <= 4) { feedbackMessage =
          "Extraordinaire ! Vous avez un talent naturel pour la recherche
          dichotomique !"; } else if (attempts <= 7) { feedbackMessage = 'Très
          bien ! Vous avez utilisé une stratégie efficace.'; } else if (attempts
          <= 10) { feedbackMessage = 'Bien joué ! Avec un peu plus de pratique,
          vous pourrez faire encore mieux.'; } else { feedbackMessage = 'Vous
          avez réussi ! Essayez d\'utiliser la méthode de recherche binaire la
          prochaine fois.'; } %>

          <div class="alert alert-success">
            <i class="fas fa-check-circle" style="margin-right: 0.5rem"></i>
            <%= feedbackMessage %>
          </div>

          <div
            style="
              margin-top: 2rem;
              display: flex;
              flex-wrap: wrap;
              justify-content: center;
              gap: 1rem;
            "
          >
            <a href="/game/play" class="btn">
              <i class="fas fa-redo-alt" style="margin-right: 0.5rem"></i>
              Rejouer
            </a>

            <a
              href="/"
              class="btn"
              style="background-color: var(--primary-color)"
            >
              <i class="fas fa-home" style="margin-right: 0.5rem"></i> Accueil
            </a>
          </div>

          <% if (!user) { %>
          <div style="margin-top: 2rem">
            <p>
              <i
                class="fas fa-info-circle"
                style="margin-right: 0.5rem; color: var(--primary-color)"
              ></i>
              <a href="/auth/register" style="color: var(--primary-color)"
                >Créez un compte</a
              >
              pour enregistrer votre score et apparaître dans le classement !
            </p>
          </div>
          <% } %>
        </div>

        <% if (user && userDetails) { %>
        <div class="card">
          <h3>Votre progression</h3>

          <div
            style="
              display: flex;
              flex-wrap: wrap;
              justify-content: space-around;
              margin-top: 1.5rem;
            "
          >
            <div style="text-align: center; padding: 1rem">
              <div
                style="
                  font-size: 1.5rem;
                  font-weight: 600;
                  color: var(--primary-color);
                "
              >
                <%= attempts %> tentatives
              </div>
              <div style="color: var(--light-text)">Cette partie</div>
            </div>

            <% if (userDetails.bestAttempts) { %>
            <div style="text-align: center; padding: 1rem">
              <div
                style="
                  font-size: 1.5rem;
                  font-weight: 600;
                  color: var(--primary-color);
                "
              >
                <%= userDetails.bestAttempts %> tentatives
              </div>
              <div style="color: var(--light-text)">Votre record</div>
            </div>
            <% } %>

            <div style="text-align: center; padding: 1rem">
              <div
                style="
                  font-size: 1.5rem;
                  font-weight: 600;
                  color: var(--primary-color);
                "
              >
                <%= userDetails.gamesPlayed %> parties
              </div>
              <div style="color: var(--light-text)">Jouées au total</div>
            </div>
          </div>

          <div style="margin-top: 1.5rem">
            <a href="/game/profile" style="color: var(--primary-color)">
              Voir mon profil complet
              <i class="fas fa-arrow-right" style="margin-left: 0.5rem"></i>
            </a>
          </div>
        </div>
        <% } %>
      </main>

      <footer>
        <p>EXPRESS BRAINS © ENI 2025 LUCE L.</p>
      </footer>
    </div>

    <script>
      // Animation des confettis
      document.addEventListener("DOMContentLoaded", function () {
        const confettiContainer = document.getElementById("confetti-container");
        const colors = [
          "#4a6fa5",
          "#6eb670",
          "#ffd700",
          "#ff6b6b",
          "#f8bbd0",
          "#a5d6a7",
        ];

        // Créer les confettis
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement("div");
          confetti.style.position = "absolute";
          confetti.style.width = Math.random() * 10 + 5 + "px";
          confetti.style.height = confetti.style.width;
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = Math.random() > 0.5 ? "50%" : "0";
          confetti.style.left = Math.random() * 100 + "%";
          confetti.style.top = "-20px";
          confetti.style.opacity = Math.random() * 0.5 + 0.5;
          confetti.style.animation =
            "confetti-fall " +
            (Math.random() * 3 + 2) +
            "s ease-in " +
            Math.random() * 3 +
            "s";
          confetti.style.animationIterationCount = "1";
          confetti.style.animationFillMode = "forwards";

          confettiContainer.appendChild(confetti);
        }
      });

      // Styles pour les confettis
      const style = document.createElement("style");
      style.innerHTML = `
      @keyframes confetti-fall {
        0% { transform: translateY(0) rotate(0); opacity: 1; }
        100% { transform: translateY(500px) rotate(720deg); opacity: 0; }
      }
      
      #confetti-container {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        overflow: hidden;
        pointer-events: none;
      }
    `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
