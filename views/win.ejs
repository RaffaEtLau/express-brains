<%- include('partials/header', { title: 'Victoire !' }) %>

<main>
  <div class="card">
    <div id="confetti-container"></div>

    <div class="number-display"><%= secretNumber %></div>

    <h2>
      <i class="fas fa-trophy" style="color: gold; margin-right: 0.5rem"></i>
      Bravo !
    </h2>
    <p style="margin-bottom: 2rem">
      Vous avez découvert le nombre mystère en
      <strong><%= attempts %></strong> tentative<%= attempts > 1 ? 's' : '' %>.
    </p>

    <div class="performance" style="margin-bottom: 2rem">
      <div
        style="
          background-color: #e2e8f0;
          height: 8px;
          border-radius: 4px;
          width: 100%;
          position: relative;
          overflow: hidden;
        "
      >
        <% let performancePercent = 0; if (attempts <= 4) { performancePercent =
        100; } else if (attempts <= 7) { performancePercent = 80; } else if
        (attempts <= 10) { performancePercent = 50; } else { performancePercent
        = 30; } let barColor = '#6eb670'; if (attempts > 10) { barColor =
        '#f56565'; } else if (attempts > 7) { barColor = '#f6e05e'; } %>
        <div
          style="
            position: absolute;
            height: 100%;
            width: <%= performancePercent %>%;
            background-color: <%= barColor %>;
            border-radius: 4px;
          "
        ></div>
      </div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-top: 0.5rem;
          font-size: 0.875rem;
          color: #718096;
        "
      >
        <span>Excellent (≤4)</span>
        <span>Bon (5-7)</span>
        <span>Peut mieux faire (8+)</span>
      </div>
    </div>

    <% let feedbackMessage = ''; if (attempts <= 4) { feedbackMessage =
    'Extraordinaire ! Vous avez un talent naturel pour la recherche dichotomique
    !'; } else if (attempts <= 7) { feedbackMessage = 'Très bien ! Vous avez
    utilisé une stratégie efficace.'; } else if (attempts <= 10) {
    feedbackMessage = 'Bien joué ! Avec un peu plus de pratique, vous pourrez
    faire encore mieux.'; } else { feedbackMessage = 'Vous avez réussi ! Essayez
    d\'utiliser la méthode de recherche binaire la prochaine fois.'; } %>

    <div class="alert alert-success">
      <i class="fas fa-check-circle" style="margin-right: 0.5rem"></i>
      <%= feedbackMessage %>
    </div>

    <div
      style="
        margin-top: 2rem;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      "
    >
      <a href="/game/play" class="btn">
        <i class="fas fa-redo-alt" style="margin-right: 0.5rem"></i> Rejouer
      </a>

      <a href="/" class="btn" style="background-color: var(--primary-color)">
        <i class="fas fa-home" style="margin-right: 0.5rem"></i> Accueil
      </a>
    </div>

    <% if (!user) { %>
    <div style="margin-top: 2rem">
      <p>
        <i
          class="fas fa-info-circle"
          style="margin-right: 0.5rem; color: var(--primary-color)"
        ></i>
        <a href="/auth/register" style="color: var(--primary-color)"
          >Créez un compte</a
        >
        pour enregistrer votre score et apparaître dans le classement !
      </p>
    </div>
    <% } %>
  </div>

  <% if (user) { %>
  <div class="card">
    <h3>Votre progression</h3>

    <div
      style="
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        margin-top: 1.5rem;
      "
    >
      <div style="text-align: center; padding: 1rem">
        <div
          style="
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
          "
        >
          <%= attempts %> tentatives
        </div>
        <div style="color: var(--light-text)">Cette partie</div>
      </div>

      <% if (userDetails && userDetails.bestAttempts) { %>
      <div style="text-align: center; padding: 1rem">
        <div
          style="
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
          "
        >
          <%= userDetails.bestAttempts %> tentatives
        </div>
        <div style="color: var(--light-text)">Votre record</div>
      </div>
      <% } %> <% if (userDetails) { %>
      <div style="text-align: center; padding: 1rem">
        <div
          style="
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
          "
        >
          <%= userDetails.gamesPlayed %> parties
        </div>
        <div style="color: var(--light-text)">Jouées au total</div>
      </div>
      <% } %>
    </div>

    <div style="margin-top: 1.5rem">
      <a href="/game/profile" style="color: var(--primary-color)">
        Voir mon profil complet
        <i class="fas fa-arrow-right" style="margin-left: 0.5rem"></i>
      </a>
    </div>
  </div>
  <% } %>
</main>

<%- include('partials/footer') %>

<script src="/js/game.js"></script>
